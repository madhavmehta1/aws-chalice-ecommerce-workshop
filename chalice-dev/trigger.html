<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<html lang="en" class="js csstransforms3d">
<head>
  <meta charset="utf-8">
  <meta property="og:title" content="Chalice For Serverless Applications" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="generator" content="Hugo 0.74.1" />
  <meta name="description" content="Chalice For Serverless Applications">
<meta name="author" content="Madhav Mehta">

  <link rel="shortcut icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />
<link rel="icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />

  <title>Post Confirmation Cognito Trigger :: Chalice For Serverless Applications</title>

  
  <link href="../css/nucleus.css" rel="stylesheet">
  <link href="../css/fontawesome-all.min.css" rel="stylesheet">
  <link href="../css/hybrid.css" rel="stylesheet">
  <link href="../css/featherlight.min.css" rel="stylesheet">
  <link href="../css/perfect-scrollbar.min.css" rel="stylesheet">
  <link href="../css/auto-complete.css" rel="stylesheet">
  <link href="../css/atom-one-dark-reasonable.css" rel="stylesheet">
  <link href="../css/theme.css" rel="stylesheet">
  <link href="../css/hugo-theme.css" rel="stylesheet">
  
  <link href="../css/theme-aws.css" rel="stylesheet">
  

  <script src="../js/jquery-3.3.1.min.js"></script>

  <style>
    :root #header + #content > #left > #rlblock_left{
        display:none !important;
    }
    
      :not(pre) > code + span.copy-to-clipboard {
          display: none;
      }
    
  </style>
  
</head>

<body class="" data-url="../chalice-dev/trigger.html">
  <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div>
    <a href="../" title="Go home">
        <img style="vertical-align:middle" src="../images/logo.png" height="70px" />
    </a>
</div>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../js/lunr.min.js"></script>
<script type="text/javascript" src="../js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="../js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/start.html" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="../start.html">
          <b>1. </b>Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/start/installation.html" title="Install Chalice" class="dd-item 
        
        
        
        ">
      <a href="../start/installation.html">
          <b>1.1 </b>Install Chalice
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/start/basics.html" title="Chalice Basics" class="dd-item 
        
        
        
        ">
      <a href="../start/basics.html">
          <b>1.2 </b>Chalice Basics
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/start/takeaways.html" title="Takeaways" class="dd-item 
        
        
        
        ">
      <a href="../start/takeaways.html">
          <b>1.3 </b>Takeaways
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/app-setup.html" title="Application Setup" class="dd-item 
        
        
        
        ">
      <a href="../app-setup.html">
          <b>2. </b>Application Setup
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/app-setup/configure-angular.html" title="Configure Angular Application" class="dd-item 
        
        
        
        ">
      <a href="../app-setup/configure-angular.html">
          <b>2.1 </b>Configure Angular Application
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/app-setup/build-angular.html" title="Build Angular Application" class="dd-item 
        
        
        
        ">
      <a href="../app-setup/build-angular.html">
          <b>2.2 </b>Build Angular Application
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/app-setup/hosting.html" title="Hosting Angular Application" class="dd-item 
        
        
        
        ">
      <a href="../app-setup/hosting.html">
          <b>2.3 </b>Hosting Angular Application
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/chalice-setup.html" title="Chalice Setup" class="dd-item 
        
        
        
        ">
      <a href="../chalice-setup.html">
          <b>3. </b>Chalice Setup
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/chalice-setup/setup.html" title="Project Structure" class="dd-item 
        
        
        
        ">
      <a href="../chalice-setup/setup.html">
          <b>3.1 </b>Project Structure
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-setup/policy.html" title="Chalice Policy" class="dd-item 
        
        
        
        ">
      <a href="../chalice-setup/policy.html">
          <b>3.2 </b>Chalice Policy
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-setup/multifile.html" title="Multifile and Blueprints" class="dd-item 
        
        
        
        ">
      <a href="../chalice-setup/multifile.html">
          <b>3.3 </b>Multifile and Blueprints
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/chalice-dev.html" title="Chalice Development" class="dd-item 
        parent
        
        
        ">
      <a href="../chalice-dev.html">
          <b>4. </b>Chalice Development
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/home.html" title="Develop Home Endpoint" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/home.html">
          <b>4.1 </b>Home Endpoint
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/trigger.html" title="Post Confirmation Cognito Trigger" class="dd-item 
        parent
        active
        
        ">
      <a href="../chalice-dev/trigger.html">
          <b>4.2 </b>Cognito Trigger
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/test-trigger.html" title="Test Post Confirmation Lambda Trigger" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/test-trigger.html">
          <b>4.3 </b>Test Cognito Trigger
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/shopping-util.html" title="Develop Shopping Cart Utility Functions" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/shopping-util.html">
          <b>4.4 </b>Shopping Cart Utility
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/shopping-end.html" title="Develop Shopping Cart Endpoint" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/shopping-end.html">
          <b>4.5 </b>Shopping Cart Endpoint
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/shopping-test.html" title="Testing the Shopping Cart Endpoint" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/shopping-test.html">
          <b>4.6 </b>Test Shopping Cart
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/checkout-util.html" title="Developing Checkout Utility Functions" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/checkout-util.html">
          <b>4.7 </b>Checkout Utility
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/checkout-end.html" title="Developing Checkout Endpoint" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/checkout-end.html">
          <b>4.8 </b>Checkout Endpoint
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/checkout-test.html" title="Testing the Checkout Endpoint" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/checkout-test.html">
          <b>4.9 </b>Test Checkout
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/order-util.html" title="Developing Order History Utility" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/order-util.html">
          <b>4.10 </b>Order History Utility
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/order-end.html" title="Developing Order History Endpoint" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/order-end.html">
          <b>4.11 </b>Order History Endpoint
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/chalice-dev/order-test.html" title="Testing the Order History Endpoint" class="dd-item 
        
        
        
        ">
      <a href="../chalice-dev/order-test.html">
          <b>4.12 </b>Testing Order History
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/cleanup.html" title="Cleanup" class="dd-item 
        
        
        
        ">
      <a href="../cleanup.html">
          <b>5. </b>Cleanup
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <left>

    <h5 class="copyright">&copy; 2020 Amazon Web Services, Inc. or its Affiliates. All rights reserved.<h5>

</left>

    </section>
  </div>
</nav>





  <section id="body">
    <div id="overlay"></div>
    <div class="padding highlightable">
      
      <div>
        <div id="top-bar">
          
          
          
          
          <div id="top-github-link">
            <a class="github-link" title='Edit this page' href="https://github.com/madhavmehta1/aws-chalice-ecommerce-workshop/tree/master/workshop/contentchalice-dev/trigger/_index.md"
              target="blank">
              <i class="fas fa-code-branch"></i>
              <span id="top-github-link-text">Edit this page</span>
            </a>
          </div>
          
          
          
          <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                <i class="fa fa-bars"></i>
              </a>
            </span>
            
            <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
            
            <span class="links">
              
          
          
          
          
          
          
          
          
          
          
          <a href='../'>Chalice For Serverless Applications</a> > <a href='../chalice-dev.html'>Chalice Development</a> > Post Confirmation Cognito Trigger
          
          
          
          
          
          
            </span>
          </div>
          
          <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#function-code">Function Code</a></li>
        <li><a href="#function-policy">Function Policy</a></li>
        <li><a href="#configure-cognito-user-pool">Configure Cognito User Pool</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

          
        </div>
      </div>
      

      
        <div id="body-inner">
          <h1>Post Confirmation Cognito Trigger</h1>
          
          



	<p>For this E-commerce application, there are some operations that need to occur outside of the REST API. The CloudFormation template used in the <a href="../app-setup.html">Application Setup</a> section created a Cognito User Pool Group for the E-commerce users. The group was attached with an IAM role so that every user on the application would assume that role when logged in. Therefore, when a new user confirms their account with Cognito, that user needs to be added to that Cognito User Pool Group. Furthermore, each new user needs a new record in the DynamoDB table. Both of these things can be done by setting a Lambda function with the necessary code as a <a href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-post-confirmation.html">Cognito Post Confirmation trigger</a>.</p>
<p>If you recollect from the Chalice Basics module at the beginning of the workshop, it was mentioned that Chalice has a <code>lambda_function()</code> decorator. Using this decorator, you can create a pure lambda function that is independent from the API handler function that Chalice creates and deploys. This means your deployment will create two Lambda functions. Generally, this is a very useful feature, because your application might need to leverage more Lambda functions that are not related to the REST API.</p>
<p>This decorator will be used to create the Cognito Post Confirmation Lambda trigger.</p>
<h3 id="function-code">Function Code</h3>
<p>For this part, you can decide to create the pure lambda function within your <code>app.py</code> or create a Blueprint of a lambda function. If you decide to use a Blueprint, just remember to import and register the Blueprint in your <code>app.py</code> file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@app.lambda_function</span>(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ecommerce-new-user-trigger&#39;</span>)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lambda_new_user_trigger</span>(event, context):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Lambda function that adds user to preconfigured Cognito user group and creates
</span><span style="color:#e6db74">        a DynamoDB record for the user.
</span><span style="color:#e6db74">        The function is triggered when a new user is confirmed through Cognito.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Add user to Cognito Group
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    cognito_provider <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;cognito-idp&#39;</span>)

    <span style="color:#75715e"># Verify that the user is confirmed and their email is verified</span>
    <span style="color:#66d9ef">if</span> event[<span style="color:#e6db74">&#39;request&#39;</span>][<span style="color:#e6db74">&#39;userAttributes&#39;</span>][<span style="color:#e6db74">&#39;cognito:user_status&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;UNCONFIRMED&#39;</span> <span style="color:#f92672">or</span> \
            event[<span style="color:#e6db74">&#39;request&#39;</span>][<span style="color:#e6db74">&#39;userAttributes&#39;</span>][<span style="color:#e6db74">&#39;email_verified&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;false&#39;</span>:
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;User is not confirmed and/or user email is not verified.&#34;</span>

    <span style="color:#75715e"># Add user to cognito group and except errors.</span>
    <span style="color:#66d9ef">try</span>:
        response <span style="color:#f92672">=</span> cognito_provider<span style="color:#f92672">.</span>admin_add_user_to_group(UserPoolId<span style="color:#f92672">=</span>event[<span style="color:#e6db74">&#39;userPoolId&#39;</span>], Username<span style="color:#f92672">=</span>event[<span style="color:#e6db74">&#39;userName&#39;</span>],
                                                            GroupName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;chalice-user-auth_policy&#39;</span>)
    <span style="color:#66d9ef">except</span> cognito_provider<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>InvalidParameterException <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e
    <span style="color:#66d9ef">except</span> cognito_provider<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>ResourceNotFoundException <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e
    <span style="color:#66d9ef">except</span> cognito_provider<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>TooManyRequestsException <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e
    <span style="color:#66d9ef">except</span> cognito_provider<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>NotAuthorizedException <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e
    <span style="color:#66d9ef">except</span> cognito_provider<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>UserNotFoundException <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e
    <span style="color:#66d9ef">except</span> cognito_provider<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>InternalErrorException <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e
    <span style="color:#66d9ef">print</span>({<span style="color:#e6db74">&#39;success&#39;</span>: True, <span style="color:#e6db74">&#39;message&#39;</span>: <span style="color:#e6db74">&#39;User was successfully added to specified Cognito user group.&#39;</span>})

    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Add user to DynamoDB table
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    table <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>resource(<span style="color:#e6db74">&#39;dynamodb&#39;</span>)<span style="color:#f92672">.</span>Table(os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;APP_TABLE_NAME&#39;</span>])
    json_address <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(event[<span style="color:#e6db74">&#39;request&#39;</span>][<span style="color:#e6db74">&#39;userAttributes&#39;</span>][<span style="color:#e6db74">&#39;address&#39;</span>])
    address_type <span style="color:#f92672">=</span> json_address[<span style="color:#e6db74">&#39;address_type&#39;</span>]
    address <span style="color:#f92672">=</span> {
        address_type: json_address
    }
    user_info <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;PK&#39;</span>: <span style="color:#e6db74">&#39;USER#&#39;</span> <span style="color:#f92672">+</span> event[<span style="color:#e6db74">&#39;request&#39;</span>][<span style="color:#e6db74">&#39;userAttributes&#39;</span>][<span style="color:#e6db74">&#39;sub&#39;</span>],
        <span style="color:#e6db74">&#39;SK&#39;</span>: <span style="color:#e6db74">&#39;USER#&#39;</span> <span style="color:#f92672">+</span> event[<span style="color:#e6db74">&#39;request&#39;</span>][<span style="color:#e6db74">&#39;userAttributes&#39;</span>][<span style="color:#e6db74">&#39;sub&#39;</span>],
        <span style="color:#e6db74">&#39;username&#39;</span>: event[<span style="color:#e6db74">&#39;userName&#39;</span>],
        <span style="color:#e6db74">&#39;addresses&#39;</span>: address,
        <span style="color:#e6db74">&#39;shopping_cart&#39;</span>: {},
        <span style="color:#e6db74">&#39;date_created&#39;</span>: datetime<span style="color:#f92672">.</span>now()<span style="color:#f92672">.</span>isoformat()
    }

    <span style="color:#75715e"># Add user information to DynamoDB and except errors.</span>
    <span style="color:#66d9ef">try</span>:
        response <span style="color:#f92672">=</span> table<span style="color:#f92672">.</span>put_item(Item<span style="color:#f92672">=</span>user_info)
    <span style="color:#66d9ef">except</span> table<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>ResourceNotFoundException <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e
    <span style="color:#66d9ef">except</span> table<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>InternalServerError <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e
    <span style="color:#66d9ef">except</span> table<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>TransactionConflictException <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e
    <span style="color:#66d9ef">except</span> table<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>RequestLimitExceeded <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">return</span> e

    <span style="color:#66d9ef">print</span>(response)
    <span style="color:#66d9ef">return</span> event
</code></pre></div><h3 id="function-policy">Function Policy</h3>
<p>Because this is completely different Lambda function, you will need to assign it the correct permissions to access DynamoDB and Cognito, otherwise this function will not work.</p>
<p>Navigate to <code>.chalice/</code> and open your <code>config.json</code> file. You will need to add and configure the <strong>lambda_functions</strong> option.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;2.0&#34;</span>,
    <span style="color:#f92672">&#34;app_name&#34;</span>: <span style="color:#e6db74">&#34;workshop-app&#34;</span>,
    <span style="color:#f92672">&#34;stages&#34;</span>: {
      <span style="color:#f92672">&#34;dev&#34;</span>: {
        <span style="color:#f92672">&#34;api_gateway_stage&#34;</span>: <span style="color:#e6db74">&#34;api&#34;</span>,
        <span style="color:#f92672">&#34;environment_variables&#34;</span>: {
          <span style="color:#f92672">&#34;APP_TABLE_NAME&#34;</span>: <span style="color:#e6db74">&#34;chalice-demo-table&#34;</span>,
          <span style="color:#f92672">&#34;S3_BUCKET&#34;</span>: <span style="color:#e6db74">&#34;[INSERT S3 BUCKET STATIC URL]&#34;</span>
        },
        <span style="color:#f92672">&#34;autogen_policy&#34;</span>: <span style="color:#66d9ef">false</span>,
        <span style="color:#f92672">&#34;iam_policy_file&#34;</span>: <span style="color:#e6db74">&#34;policies/policy-dev.json&#34;</span>,
        <span style="color:#f92672">&#34;lambda_functions&#34;</span>: {
          <span style="color:#f92672">&#34;ecommerce-new-user-trigger&#34;</span>: {
            <span style="color:#f92672">&#34;autogen_policy&#34;</span>: <span style="color:#66d9ef">false</span>,
            <span style="color:#f92672">&#34;iam_policy_file&#34;</span>: <span style="color:#e6db74">&#34;policies/trigger-dev.json&#34;</span>
          }
        }
      }
    }
}
</code></pre></div><p>Looking at the decorator for the lambda function, you can see that the name parameter is <code>ecommerce-new-user-trigger</code>. You can change this if desired. The config will need to match this name. The options <strong>autogen_policy</strong> and <strong>iam_policy_file</strong> need to be set as well. In this case, you will need to use a custom policy document so set them to <code>false</code> and <code>policies/trigger-dev.json</code>.</p>
<p>You have now directed Chalice to not auto generate a policy for this Lambda function and have specified the file path to the policy document that it should load. Now you need to set the policy at that file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
    <span style="color:#f92672">&#34;Statement&#34;</span>: [
        {
            <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
            <span style="color:#f92672">&#34;Action&#34;</span>: [
                <span style="color:#e6db74">&#34;dynamodb:PutItem&#34;</span>,
                <span style="color:#e6db74">&#34;cognito-idp:AdminAddUserToGroup&#34;</span>
            ],
            <span style="color:#f92672">&#34;Resource&#34;</span>: [
                <span style="color:#e6db74">&#34;[INSERT DYNAMODB TABLE ARN]&#34;</span>,
                <span style="color:#e6db74">&#34;[INSERT COGNITO USER POOL ARN]&#34;</span>
            ]
        }
    ]
}
</code></pre></div><h3 id="configure-cognito-user-pool">Configure Cognito User Pool</h3>
<p>Push your code changes to your repository. Once the application has deployed, you will want to configure your Cognito user pool to use it. From the AWS Console, navigate to Cognito User Pools and click on your User Pool. On the left-hand side panel, click on the option that says <strong>Triggers</strong>. Scroll to find the <strong>Post confirmation</strong> trigger and select your newly deployed trigger.
<img src="../images/trigger-config.png" alt="Trigger"></p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../chalice-dev/home.html" title="Develop Home Endpoint"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../chalice-dev/test-trigger.html" title="Test Post Confirmation Lambda Trigger" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../js/clipboard.min.js"></script>
    <script src="../js/perfect-scrollbar.min.js"></script>
    <script src="../js/perfect-scrollbar.jquery.min.js"></script>
    <script src="../js/jquery.sticky.js"></script>
    <script src="../js/featherlight.min.js"></script>
    <script src="../js/html5shiv-printshiv.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../js/modernizr.custom-3.6.0.js"></script>
    <script src="../js/learn.js"></script>
    <script src="../js/hugo-learn.js"></script>

    <link href="../mermaid/mermaid.css" rel="stylesheet" />
    <script src="../mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <div id = 'kinesisStreamName' title = ""/></div>
<div id = 'cognitoPoolId' title = ""/></div>
<div id = 'awsRegion' title = ""/></div>
<div id = 'contentId' title = ""/></div>
<div id = 'language' title = "en"/></div>
<div id = 'versions' title = ""/></div>

<script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
<script src="../js/kinesis.js"></script>
  </body>
</html>
